<div class="board">
    <div class="board-wrapper" *ngIf="!isMobile && canEdit"
        cdkDropList [cdkDropListData]="columns" cdkDropListOrientation="horizontal" (cdkDropListDropped)="dropColumn($event)">

        <!-- ALL COLUMN DETAILS FOR NO-MOBILE STARTS -->
        <div class="board-columns" cdkDropListGroup *ngIf="columns">

            <div class="board-column" id="column._id" cdkDrag *ngFor="let column of columns; let i = index;">
                <!-- COLUMN TITLE AND EDIT/DELETE DETAILS STARTS -->
                <div class="column-title" cdkDragHandle>
                    <p class="text-capitalize" [matTooltip]="column?.title">
                      <!-- SHUTTLE COLUMN -->
                      <img *ngIf="isShuttleTasksModuleAvailable && column?._id == (groupData?._shuttle_section?._id || groupData?._shuttle_section)" src="assets/images/icon-task-shuttle.svg" alt="" style="width: 24px;">
                      <img src="assets/images/Icon/icon_project.svg" alt="" class="mr-2" *ngIf="column?.project_type">
                      {{ column?.title | truncatetext:20 }}
                    </p>

                    <div class="inline-block">
                        <div *ngIf="column?.canEdit" class="dropdown">
                            <i class="material-icons action dropdown-toggle"
                                data-toggle="dropdown">more_horiz</i>

                            <!-- Menu Drawer Starts -->
                            <ul class="dropdown-menu">
                                <li class="dropdown-item" (click)="column.editColumn = !column.editColumn">
                                  <span class="material-icons-outlined">create</span>
                                  <span i18n="@@groupKanbanBoard.edit">Edit</span>
                                </li>
                                <li *ngIf="userData?.role == 'admin' || userData?.role == 'owner' || isGroupManager()"
                                    class="dropdown-item" (click)="deleteColumn(column)">
                                  <span class="material-icons-outlined">delete</span>
                                  <span i18n="@@groupDashboard.delete">Delete</span>
                                </li>
                                <li *ngIf="(!isShuttleTasksModuleAvailable || column?._id != (groupData?._shuttle_section?._id || groupData?._shuttle_section)) && (userData?.role == 'admin' || userData?.role == 'owner' || isGroupManager()) && !isIndividualSubscription"
                                    class="dropdown-item" (click)="archiveColumn(column)">
                                  <span class="material-icons-outlined">archive</span>
                                  <span i18n="@@groupDashboard.archive">Archive</span>
                                </li>
                                <li class="dropdown-item" *ngIf="groupData?.project_type" (click)="makeColumnProjectDialog(column)">
                                  <img src="assets/images/Icon/icon_launch_project.svg" alt="" >
                                  <span i18n="@@groupDashboard.launchProject">Launch Project</span>
                                </li>
                                <li *ngIf="column?.canEdit && !isIndividualSubscription" class="dropdown-item" (click)="openShowCFDialog(column)">
                                  <span class="material-icons-outlined">auto_awesome</span>
                                  <span i18n="@@groupDashboard.showCF">Show CF Data</span>
                                </li>
                                <li class="dropdown-item" *ngIf="groupData && checkDataExist(groupData) && groupData.enabled_rights" (click)="openPermissionModal(column)">
                                  <span class="material-icons-outlined">vpn_lock</span>
                                  <span i18n="@@groupDashboard.permissions">Permissions</span>
                                </li>
                            </ul>
                            <!-- Menu Drawer Ends -->
                        </div>
                    </div>
                </div>
                <!-- COLUMN TITLE AND EDIT/DELETE DETAILS ENDS -->

                <!-- EDIT COLUMN STARTS -->
                <app-edit-column *ngIf="column && column?.canEdit" [column]="column" (column)="editColumn(column, $event)">
                </app-edit-column>
                <!-- EDIT COLUMN ENDS -->

                <!-- COLUMN STATS SECTION STARTS -->
                <div class="project-container">
                  {{ column?.tasks?.length }} <span i18n="@@groupDashboard.tasksDone">Tasks</span>
                  <span class="float-right badge donebadge">
                    {{ column?.numDoneTasks || 0 }} Done
                  </span>
                </div>
                <!-- COLUMN STATS SECTION ENDS -->

                <!-- COLUMN PROJECT SECTION STARTS -->
                <app-column-project-section *ngIf="column?.project_type"
                  [column]="column"
                  [userData]="userData"
                  [groupData]="groupData"></app-column-project-section>
                <!-- COLUMN PROJECT SECTION ENDS -->

                <!-- CUSTOM FIELDS STATS SECTION STARTS -->
                <div class="project-container" *ngFor="let cfName of column.custom_fields_to_show_kanban">
                  {{ cfName }}
                  <span class="float-right done">
                    {{ calculateCFStatistics(cfName, column.tasks) | number }}
                  </span>
                </div>
                <!-- CUSTOM FIELDS STATS SECTION ENDS -->

                <!-- TASK CONTAINER STARTS -->
                <div class="tasks-container" [id]="column._id"
                    cdkDropList [cdkDropListData]="column.tasks"
                    (cdkDropListDropped)="drop($event)">

                    <!-- CREATE TASK STARTS -->
                    <app-new-task *ngIf="column?.canEdit" [groupData]="groupData" [userData]="userData" [column]="column"
                        (post)="getPost($event, column)" [isIdeaModuleAvailable]="isIdeaModuleAvailable"></app-new-task>
                    <!-- CREATE TASK ENDS -->

                    <!-- TASK DETAILS STARTS -->
                    <app-kanban-task-card cdkDrag *ngFor="let task of column.tasks; let j = index;"
                        (click)="openFullscreenModal(task)"
                        [isProject]="column?.project_type"
                        [isDelay]="isDelay(task?.task?.due_to, column?.due_date)"
                        [task]="task"
                        [isIdeaModuleAvailable]="isIdeaModuleAvailable"
                        [groupId]="groupData?._id">
                      <div *cdkDragPlaceholder></div>
                    </app-kanban-task-card>
                    <!-- TASK DETAILS ENDS -->
                </div>
                <!-- TASK CONTAINER ENDS -->
            </div>

            <!-- CREATE NEW SECTION START -->
            <app-create-column (column)="addColumn($event)"></app-create-column>
            <!-- CREATE NEW SECTION ENDS -->

        </div>
        <!-- ALL COLUMN DETAILS FOR NO-MOBILE ENDS -->
      </div>

      <div class="board-wrapper" *ngIf="isMobile || !canEdit">
        <!-- ALL COLUMN DETAILS FOR MOBILE STARTS -->
        <div class="board-columns" *ngIf="columns">

            <div class="board-column" *ngFor="let column of columns; let i = index;">
                <!-- COLUMN TITLE AND EDIT/DELETE DETAILS STARTS -->
                <div class="column-title">
                    <p class="text-capitalize" [matTooltip]="column?.title">
                      <img *ngIf="isShuttleTasksModuleAvailable && column?._id == (groupData?._shuttle_section?._id || groupData?._shuttle_section)" src="assets/images/icon-task-shuttle.svg" alt="" style="width: 24px;">
                      <img src="assets/images/Icon/icon_project.svg" alt="" class="mr-2" *ngIf="column?.project_type">
                      {{ column?.title | truncatetext:20 }}
                    </p>

                    <div class="inline-block">
                        <div *ngIf="column?.canEdit" class="dropdown">
                            <i class="material-icons action dropdown-toggle"
                                data-toggle="dropdown">more_horiz</i>

                            <!-- Menu Drawer Starts -->
                            <ul class="dropdown-menu">
                                <li class="dropdown-item" (click)="column.editColumn = !column.editColumn">
                                  <span class="material-icons-outlined">create</span>
                                  <span i18n="@@groupKanbanBoard.edit">Edit</span>
                                </li>
                                <li *ngIf="(userData?.role == 'admin' || userData?.role == 'owner' || isGroupManager())"
                                    class="dropdown-item" (click)="deleteColumn(column)">
                                  <span class="material-icons-outlined">delete</span>
                                  <span i18n="@@groupDashboard.delete">Delete</span>
                                </li>
                                <li *ngIf="(!isShuttleTasksModuleAvailable || column?._id != (groupData?._shuttle_section?._id || groupData?._shuttle_section)) && (userData?.role == 'admin' || userData?.role == 'owner' || isGroupManager()) && !isIndividualSubscription"
                                    class="dropdown-item" (click)="archiveColumn(column)">
                                  <span class="material-icons-outlined">archive</span>
                                  <span i18n="@@groupDashboard.archive">Archive</span>
                                </li>
                                <li class="dropdown-item" *ngIf="groupData?.project_type" (click)="makeColumnProjectDialog(column)">
                                  <img src="assets/images/Icon/icon_launch_project.svg" alt="" >
                                  <span i18n="@@groupDashboard.launchProject">Launch Project</span>
                                </li>
                                <li *ngIf="column?.canEdit && !isIndividualSubscription" class="dropdown-item" (click)="openShowCFDialog(column)">
                                  <span class="material-icons-outlined">auto_awesome</span>
                                  <span i18n="@@groupDashboard.showCF">Show CF Data</span>
                                </li>
                                <li class="dropdown-item" *ngIf="groupData && checkDataExist(groupData) && groupData.enabled_rights" (click)="openPermissionModal(column)">
                                  <span class="material-icons-outlined">vpn_lock</span>
                                  <span i18n="@@groupDashboard.permissions">Permissions</span>
                                </li>
                            </ul>
                            <!-- Menu Drawer Ends -->
                        </div>
                    </div>
                </div>
                <!-- COLUMN TITLE AND EDIT/DELETE DETAILS ENDS -->

                <!-- EDIT COLUMN STARTS -->
                <app-edit-column *ngIf="column && column?.canEdit" [column]="column" (column)="editColumn(column, $event)">
                </app-edit-column>
                <!-- EDIT COLUMN ENDS -->

                <!-- COLUMN STATS SECTION STARTS -->
                <div class="project-container">
                  {{ column?.tasks?.length }} <span i18n="@@groupDashboard.tasksDone">Tasks</span>
                  <span class="float-right done">
                    {{ column?.numDoneTasks || 0 }} Done
                  </span>
                </div>
                <!-- COLUMN STATS SECTION ENDS -->

                <!-- COLUMN PROJECT SECTION STARTS -->
                <app-column-project-section *ngIf="column?.project_type"
                  [column]="column"
                  [userData]="userData"
                  [groupData]="groupData"></app-column-project-section>
                <!-- COLUMN PROJECT SECTION ENDS -->

                <!-- CUSTOM FIELDS STATS SECTION STARTS -->
                <div class="project-container" *ngFor="let cfName of column.custom_fields_to_show_kanban">
                  {{ cfName }}
                  <span class="float-right done">
                    {{ calculateCFStatistics(cfName, column.tasks) | number }}
                  </span>
                </div>
                <!-- CUSTOM FIELDS STATS SECTION ENDS -->

                <!-- TASK CONTAINER STARTS -->
                <div class="tasks-container" [id]="column._id">
                    <!-- CREATE TASK STARTS -->
                    <app-new-task *ngIf="column?.canEdit" [groupData]="groupData" [userData]="userData" [column]="column"
                        (post)="getPost($event, column)" [isIdeaModuleAvailable]="isIdeaModuleAvailable"></app-new-task>
                    <!-- CREATE TASK ENDS -->

                    <!-- TASK DETAILS STARTS -->
                    <app-kanban-task-card *ngFor="let task of column.tasks; let j = index;"
                      (click)="openFullscreenModal(task)"
                      [isProject]="column?.project_type"
                      [isDelay]="isDelay(task?.task?.due_to, column?.due_date)"
                      [task]="task"
                      [isIdeaModuleAvailable]="isIdeaModuleAvailable"
                      [groupId]="groupData?._id">
                    </app-kanban-task-card>
                    <!-- TASK DETAILS ENDS -->
                </div>
                <!-- TASK CONTAINER ENDS -->
            </div>

            <!-- CREATE NEW SECTION START -->
            <app-create-column (column)="addColumn($event)"></app-create-column>
            <!-- CREATE NEW SECTION ENDS -->

        </div>
        <!-- ALL COLUMN DETAILS FOR MOBILE ENDS -->
    </div>

    <!-- placeholder for empty board starts -->
    <div *ngIf="!columns || columns.length == 0" style="text-align: center;">
      <img src='assets/images/placeholder_activity3.png' class="placeholder-img">
      <p class="muted text-center" i18n="@@groupDashboard.boardEmpty">This board is empty. Create a section to add tasks. </p>
    </div>
    <!-- placeholder for empty board ends -->
</div>
