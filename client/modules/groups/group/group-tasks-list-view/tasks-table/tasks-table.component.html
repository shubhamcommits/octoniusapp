<div class="table-container">
<table mat-table [dataSource]="dataSource" matSort>
  <!-- title Column -->
  <ng-container matColumnDef="title" sticky>
    <th mat-header-cell *matHeaderCellDef mat-sort-header i18n="@@asksTableView.title"> Title </th>
    <td mat-cell *matCellDef="let task">
      <div class="statusbar" [ngClass]="getTaskClass(task?.task?.status, task?.task?.isNorthStar, task?.task?.is_milestone, (task?.task?.shuttle_type && task?.task?._shuttle_group == groupData._id), task?.task?.shuttle_status)">
        <app-inline-input
            [(ngModel)]="task.title"
            label="Name"
            [domainObject]="task"
            [required]="true"
            type="text"
            (post)="fieldUpdated($event)">
        </app-inline-input>
      </div>
    </td>
  </ng-container>

  <!-- percentage Column -->
  <ng-container matColumnDef="nsPercent">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let task">
      <div class="ns_cell" *ngIf="task?.task?.isNorthStar">
        <div [ngClass]="getNSStatusClass(task?.task?.northStar)">
          {{ getProgressPercent(task?.task?.northStar) | percent: '.2-2'}}
        </div>
      </div>
    </td>
  </ng-container>

  <!-- tags Column -->
  <ng-container matColumnDef="tags">
    <th mat-header-cell *matHeaderCellDef i18n="@@asksTableView.tags"> Tags </th>
    <td mat-cell *matCellDef="let task">
      <div>
        <div class="tags" *ngIf="task?.tags.length <= 1">
            <span class="badge" *ngFor="let tag of task?.tags">
                {{ tag }}
            </span>
        </div>
        <div class="tags" *ngIf="task?.tags.length > 1">
            <span class="badge">
                {{ task?.tags[0] }}
            </span>
            <span class="badge">
                +{{ task?.tags.length-1 }}
            </span>
        </div>
      </div>
    </td>
  </ng-container>

  <!-- Assignee Column -->
  <ng-container matColumnDef="asignee">
    <th mat-header-cell *matHeaderCellDef i18n="@@asksTableView.assignee"> Assignee </th>
    <td mat-cell *matCellDef="let task">
      <app-assignee-avatar [post]="task" [userData]="userData"></app-assignee-avatar>
    </td>
  </ng-container>

  <!-- Due date Column -->
  <ng-container matColumnDef="due_to">
    <th mat-header-cell *matHeaderCellDef i18n="@@asksTableView.dueDate"> Due Date </th>
    <td mat-cell *matCellDef="let task">
      <div *ngIf="!task?.task?.isNorthStar">
        <app-inline-input
            *ngIf="task.task.due_to != 'Invalid date'"
            [(ngModel)]="task.task.due_to"
            [styleClass]="checkOverdue(task) ? 'overdue' : 'due'"
            [domainObject]="task"
            [required]="true"
            type="date"
            (post)="fieldUpdated($event)">
        </app-inline-input>
      </div>
      <div *ngIf="task?.task?.isNorthStar">
        {{task.task.due_to | date:'MMM dd, yyyy' }}
      </div>
    </td>
  </ng-container>

  <!-- CUSTOM FIELDS START -->
  <ng-container [matColumnDef]="cf.name" *ngFor="let cf of customFieldsToShow">
    <th mat-header-cell *matHeaderCellDef>
      <div class="cf_cell" >
        {{ cf.title }}
        <i class="material-icons small" *ngIf="isAdmin && cf.name != 'priority'" (click)="removeColumn(cf)"
          style="cursor: pointer;">close</i>
      </div>
    </th>
    <td mat-cell *matCellDef="let task">
      <div class="cf_cell">
        <app-inline-input
            [customFieldName]="cf.name"
            [customFieldInputType]="cf.input_type"
            [domainObject]="task"
            [required]="true"
            [options]="customFieldValues(cf.name)"
            [groupId]="groupData._id"
            type="customField"
            (post)="fieldUpdated($event)">
        </app-inline-input>
      </div>
    </td>
  </ng-container>
  <!-- CUSTOM FIELDS ENDS -->

  <!-- Star Column -->
  <ng-container matColumnDef="star">
    <th mat-header-cell *matHeaderCellDef>
      <div class="">
        <i class="material-icons-outlined" style="cursor: pointer;"
          *ngIf="isAdmin" [matMenuTriggerFor]="addColumn">add</i>
      </div>
      <mat-menu #addColumn="matMenu">
          <div class="newColumnMatMenu">
              <span i18n="@@asksTableView.addCF">Add custom field</span>
              <mat-form-field>
                <mat-label i18n="@@asksTableView.selectOption">Select an option</mat-label>
                  <mat-select ngDefaultControl
                      (selectionChange)="addNewColumn($event)"
                      (click)="$event.stopPropagation()"
                      [(ngModel)]="newColumnSelected"
                      name="new_column">
                    <mat-option *ngFor="let f of customFields" [value]="f">{{ f.title }}</mat-option>
                  </mat-select>
              </mat-form-field>
          </div>
      </mat-menu>
    </th>
    <td mat-cell *matCellDef="let task">
      <i class="material-icons-outlined muted" [matMenuTriggerFor]="menu" style="cursor: pointer;">more_horiz</i>
      <mat-menu #menu="matMenu">
        <a mat-menu-item (click)="openFullscreenModal(task)">
            <i class="material-icons-outlined ml-2"Â style="margin-right: .7rem;">visibility</i>
            <span i18n="@@asksTableView.view">View</span>
        </a>
      </mat-menu>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let task; columns: displayedColumns;" [ngClass]="{ 'north-star': task?.task?.isNorthStar , 'milestone': task?.task?.is_milestone}">
  </tr>
</table>
</div>
<!-- DONE TASKS -->
<!--
<app-done-tasks-list-view *ngIf="tasks['done']"
  [tasks]="tasks['done']"
  [sections]="sections"
  [section]="section"
  [groupData]="groupData"
  [userData]="userData"
  [displayedColumns]="displayedColumns"
  [customFieldsToShow]="customFieldsToShow"
  (closeDoneTaskModalEvent)="onCloseDoneTaskModalEvent($event)">
</app-done-tasks-list-view>
-->
<!-- DONE TASKS ENDS-->
