<table mat-table [dataSource]="tasks" class="tasks-container">
  <!-- title Column -->
  <ng-container matColumnDef="title" sticky>
    <th mat-header-cell *matHeaderCellDef> Title </th>
    <td mat-cell *matCellDef="let task">
      <div>
        <app-inline-input
            [(ngModel)]="task.title"
            label="Name"
            [domainObject]="task"
            [required]="true"
            type="text"
            (post)="fieldUpdated($event, task)">
        </app-inline-input>
      </div>
    </td>
  </ng-container>

  <!-- percentage Column -->
  <ng-container matColumnDef="nsPercent">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let task">
      <div class="col-md-1" *ngIf="task?.task?.isNorthStar">
        <div [ngClass]="getNSStatusClass(task?.task?.northStar)">
          {{ getProgressPercent(task?.task?.northStar) | percent: '.2-2'}}
        </div>
      </div>
    </td>
  </ng-container>

  <!-- tags Column -->
  <ng-container matColumnDef="tags">
    <th mat-header-cell *matHeaderCellDef> Tags </th>
    <td mat-cell *matCellDef="let task">
      <div>
        <div class="tags" *ngIf="task?.tags.length <= 1">
            <span class="badge" *ngFor="let tag of task?.tags">
                {{ tag }}
            </span>
        </div>
        <div class="tags" *ngIf="task?.tags.length > 1">
            <span class="badge">
                {{ task?.tags[0] }}
            </span>
            <span class="badge">
                +{{ task?.tags.length-1 }}
            </span>
        </div>
      </div>
    </td>
  </ng-container>

  <!-- Assignee Column -->
  <ng-container matColumnDef="asignee">
    <th mat-header-cell *matHeaderCellDef> Assignee </th>
    <td mat-cell *matCellDef="let task">
      <div *ngIf="!task?.task?.isNorthStar" class="feed-avatar">
        <app-inline-input
            [(ngModel)]="task.task._assigned_to"
            [domainObject]="task"
            [required]="true"
            [workspaceId]="groupData._workspace._id"
            [userData]="userData"
            [groupId]="groupData._id"
            type="assignee"
            (post)="fieldUpdated($event, task)">
        </app-inline-input>
      </div>
      <div *ngIf="task?.task?.isNorthStar">
        <img src="{{ baseUrl }}/{{ task?.task?._assigned_to?.profile_pic }}"
        onerror="this.src='assets/images/user.png'"
        class="feed-avatar">
      </div>
    </td>
  </ng-container>

  <!-- Due date Column -->
  <ng-container matColumnDef="due_to">
    <th mat-header-cell *matHeaderCellDef> Due Date </th>
    <td mat-cell *matCellDef="let task">
      <div *ngIf="!task?.task?.isNorthStar">
        <app-inline-input
            *ngIf="task.task.due_to != 'Invalid date'"
            [(ngModel)]="task.task.due_to"
            [styleClass]="checkOverdue(task) === true ? 'overdue' : 'due'"
            [domainObject]="task"
            [required]="true"
            type="date"
            (post)="fieldUpdated($event, task)">
        </app-inline-input>
      </div>
      <div *ngIf="task?.task?.isNorthStar">
        {{task.task.due_to | date:'MMM dd, yyyy' }}
      </div>
    </td>
  </ng-container>

  <!-- CUSTOM FIELDS START -->
  <ng-container [matColumnDef]="cf.name" *ngFor="let cf of customFieldsToShow">
    <th mat-header-cell *matHeaderCellDef>
      <div class="task_cell_cf" >
        {{ cf.title }}
        <i class="material-icons" *ngIf="isAdmin" (click)="removeColumn(cf)"
          style="cursor: pointer;">highlight_off</i>
      </div>
    </th>
    <td mat-cell *matCellDef="let task">
      <div class="task_cell_cf">
        <app-inline-input
            [customFieldName]="cf.name"
            [domainObject]="task"
            [required]="true"
            [options]="customFieldValues(cf.name)"
            type="customField"
            (post)="fieldUpdated($event, task)">
        </app-inline-input>
      </div>
    </td>
  </ng-container>
  <!-- CUSTOM FIELDS ENDS -->

  <!-- Star Column -->
  <ng-container matColumnDef="star" stickyEnd>
    <th mat-header-cell *matHeaderCellDef>
      <div class="task_cell_more">
        <i class="material-icons-outlined" style="cursor: pointer;"
          *ngIf="isAdmin" [matMenuTriggerFor]="addColumn">add</i>
      </div>
      <mat-menu #addColumn="matMenu">
          <div class="newColumnMatMenu">
              Add custom field
              <mat-form-field>
                  <mat-select ngDefaultControl
                      (selectionChange)="addNewColumn($event)"
                      (click)="$event.stopPropagation()"
                      [(ngModel)]="newColumnSelected"
                      name="new_column">
                    <mat-option *ngFor="let f of customFields" [value]="f">{{ f.title }}</mat-option>
                  </mat-select>
              </mat-form-field>
          </div>
      </mat-menu>
    </th>
    <td mat-cell *matCellDef="let task">
      <i class="material-icons-outlined ml-2 muted" [matMenuTriggerFor]="menu" style="cursor: pointer;">more_horiz</i>
      <mat-menu #menu="matMenu">
        <a mat-menu-item (click)="openFullscreenModal(task)">
            <i class="material-icons-outlined ml-2"Â style="margin-right: .7rem;">visibility</i>
            <span>View</span>
        </a>
      </mat-menu>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let task; columns: displayedColumns;"
    [ngClass]="{'status-todo': task?.task?.status === 'to do', 'status-inprogress': task?.task?.status === 'in progress', 'north-star': task?.task?.isNorthStar }">
  </tr>
</table>

<!-- DONE TASKS -->
<app-done-tasks-list-view *ngIf="tasks['done']"
  [tasks]="tasks['done']"
  [sections]="sections"
  [section]="section"
  [groupData]="groupData"
  [userData]="userData"
  [displayedColumns]="displayedColumns"
  [customFieldsToShow]="customFieldsToShow"
  (closeDoneTaskModalEvent)="onCloseDoneTaskModalEvent($event)">
</app-done-tasks-list-view>
<!-- DONE TASKS ENDS-->
