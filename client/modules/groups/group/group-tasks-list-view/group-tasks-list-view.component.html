<div class="list">
    <div class="list-wrapper">
        <!-- HEADER ROW -->
        <div class="list-view-header">


            <div class="task_row_header">
                <div class="task_content">

                        <div class="task_title">Title</div>


                    <div class="task_cell_tag">
                        Tags
                    </div>

                    <div class="task_cell_assignee">
                        Assignee
                    </div>

                    <div class="task_cell_date">
                        Due Date
                    </div>

                    <div class="task_cell_cf" *ngFor="let field of customFieldsToShow" >
                        {{ field.title }}
                            <i class="material-icons"
                                *ngIf="isAdmin"
                                (click)="removeColumn(field)"
                                style="cursor: pointer;">highlight_off</i>

                    </div>

                    <div class="task_cell_more">
                        <i class="material-icons-outlined" style="cursor: pointer;"
                                *ngIf="isAdmin"
                                [matMenuTriggerFor]="addColumn">
                            add
                        </i>
                    </div>
                    <mat-menu #addColumn="matMenu">
                        <div class="newColumnMatMenu">
                            Add custom field
                            <mat-form-field>
                                <mat-select ngDefaultControl
                                        (selectionChange)="addNewColumn($event)"
                                        (click)="$event.stopPropagation()"
                                        [(ngModel)]="newColumnSelected"
                                        name="new_column">
                                    <mat-option *ngFor="let f of customFields" [value]="f">{{ f.title }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-menu>
                </div>
            </div>
        </div>
        <!-- HEADER ROW -->

        <!-- ALL COLUMN DETAILS STARTS -->
        <div class="list-columns" *ngIf="this.columns">

          <mat-accordion multi>
            <mat-expansion-panel class="list-column" style="background-color: #fafafa; box-shadow: none;"  id="column.title" *ngFor="let column of columns; first as isFirst" [expanded]="isFirst" >
              <mat-expansion-panel-header class="column-title">
                <!-- COLUMN TITLE -->
                <mat-panel-title>
                  <p class="muted"> {{ column?.title }}</p>
                </mat-panel-title>
                <!-- COLUMN TITLE -->
                <mat-panel-description>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <!-- TASK CONTAINER STARTS -->
              <div class="tasks-container" [id]="column.title">

                <!-- CREATE TASK STARTS -->
                <app-new-task [groupData]="groupData" [userData]="userData" [column]="column"
                    (post)="getPost($event, column)"></app-new-task>
                <!-- CREATE TASK ENDS -->

                <!-- TASK DETAILS STARTS -->
                <div class="task_row"
                    [ngClass]="{'status-todo': task?.task?.status === 'to do', 'status-inprogress': task?.task?.status === 'in progress', 'status-done': task?.task?.status === 'done'}"
                    *ngFor="let task of column.tasks; let j = index;">

                    <div class="task_content">
                        <div class="task_title">
                            <app-inline-input
                                [(ngModel)]="task.title"
                                label="Name"
                                [domainObject]="task"
                                [required]="true"
                                type="text"
                                (post)="fieldUpdated($event, task)">
                            </app-inline-input>
                        </div>
                        <div class="task_cell_tag">
                          <div class="tags" *ngIf="task?.tags.length <= 1">
                              <span class="badge" *ngFor="let tag of task?.tags">
                                  {{ tag }}
                              </span>
                          </div>
                          <div class="tags" *ngIf="task?.tags.length > 1">
                              <span class="badge">
                                  {{ task?.tags[0] }}
                              </span>
                              <span class="badge">
                                  +{{ task?.tags.length-1 }}
                              </span>
                          </div>
                      </div>
                      <div class="task_cell_asignee">
                          <app-inline-input
                              [(ngModel)]="task.task._assigned_to"
                              [domainObject]="task"
                              [required]="true"
                              [workspaceId]="groupData._workspace._id"
                              [userData]="userData"
                              [groupId]="groupData._id"
                              type="assignee"
                              (post)="fieldUpdated($event, task)">
                          </app-inline-input>
                      </div>

                      <div class="task_cell_date">
                          <app-inline-input
                              *ngIf="task.task.due_to != 'Invalid date'"
                              [(ngModel)]="task.task.due_to"
                              [styleClass]="checkOverdue(task) === true ? 'overdue' : 'due'"
                              [domainObject]="task"
                              [required]="true"
                              type="date"
                              (post)="fieldUpdated($event, task)">
                          </app-inline-input>
                      </div>

                      <div class="task_cell_cf" *ngFor="let field of customFieldsToShow" >
                          <app-inline-input
                              [customFieldName]="field.name"
                              [domainObject]="task"
                              [required]="true"
                              [options]="customFieldValues(field.name)"
                              type="customField"
                              (post)="fieldUpdated($event, task)">
                          </app-inline-input>
                      </div>

                      <div class="task_cell_more">
                          <i class="material-icons-outlined ml-2 muted" [matMenuTriggerFor]="menu" style="cursor: pointer;">more_horiz</i>
                          <mat-menu #menu="matMenu">
                              <a mat-menu-item (click)="openFullscreenModal(task)">
                                  <i class="material-icons-outlined ml-2"Â style="margin-right: .7rem;">visibility</i>
                                  <span>View</span>
                              </a>
                          </mat-menu>
                      </div>
                  </div>
                </div>
                <!-- TASK DETAILS ENDS -->
              </div>
              <!-- TASK CONTAINER ENDS -->

            </mat-expansion-panel>
          </mat-accordion>

          <!-- CREATE NEW SECTION START -->
          <app-create-section (section)="addSection($event)"></app-create-section>
          <!-- CREATE NEW SECTION ENDS -->
        </div>
    </div>
</div>
