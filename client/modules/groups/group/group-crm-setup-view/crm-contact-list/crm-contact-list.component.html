<div class="block">
    <!--
    <table class="table table-responsive table-hover">
        <tr>
            <th class="pointer" (click)="sort('company')">
                <span i18n="@@crmContactList.company">Company</span>
                <i *ngIf="column != 'company'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'company'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th class="pointer" (click)="sort('name')">
                <span i18n="@@crmContactList.name">Name</span>
                <i *ngIf="column != 'name'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'name'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th class="pointer" (click)="sort('description')">
                <span i18n="@@crmContactList.description">Description</span>
                <i *ngIf="column != 'description'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'description'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th class="pointer" (click)="sort('phones')">
                <span i18n="@@crmContactList.phone">Phone</span>
                <i *ngIf="column != 'phones'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'phones'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th class="pointer" (click)="sort('emails')">
                <span i18n="@@crmContactList.email">E-Mail</span>
                <i *ngIf="column != 'emails'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'emails'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th class="pointer" (click)="sort('links')">
                <span i18n="@@crmContactList.link">Link</span>
                <i *ngIf="column != 'links'" class="material-icons muted mr-5">sort</i>
                <i *ngIf="column == 'links'" class="material-icons muted mr-5">swap_vert</i>
            </th>
            <th></th>
        </tr>

        <tr *ngFor="let contact of contacts">
            <td>
                <app-secured-image [imgURL]="contact?.company_history[0]?._company?.company_pic" [service]="'group'"
                    [workspaceId]="workspaceData?._id" [styleClass]="'group-avatar'"></app-secured-image>
                {{ contact?.company_history[0]?._company?.name }}
            </td>
            <td>{{ contact.name }}</td>
            <td>{{ contact.description }}</td>
            <td>{{ contact.phones[0] }}</td>
            <td>{{ contact.emails[0] }}</td>
            <td>{{ contact.links[0] }}</td>
            <td>
                <i class="material-icons-outlined ml-2 muted pointer" [matMenuTriggerFor]="menu">more_horiz</i>
                <mat-menu #menu="matMenu">
                    <a mat-menu-item (click)="openNewContactDialog(contact._id)">
                        <span i18n="@@crmContactList.edit">Edit</span>
                    </a>
                    <a mat-menu-item (click)="deleteContact(contact._id)">
                        <span i18n="@@crmContactList.delete">Delete</span>
                    </a>
                </mat-menu>
            </td>
        </tr>
    </table>
    -->



    <table mat-table [dataSource]="contacts" class="">
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef i18n="@@crmContactList.name"> Name </th>
        
            <td mat-cell *matCellDef="let contact">
                <span>{{ contact.name }}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef i18n="@@crmContactList.description"> Description </th>
        
            <td mat-cell *matCellDef="let contact">
                <span>{{ contact.description }}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="phone">
            <th mat-header-cell *matHeaderCellDef i18n="@@crmContactList.phone"> Phone </th>
        
            <td mat-cell *matCellDef="let contact">
                <span>{{ contact.phones[0] }}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef i18n="@@crmContactList.email"> E-Mail </th>
        
            <td mat-cell *matCellDef="let contact">
                <span>{{ contact.emails[0] }}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="link">
            <th mat-header-cell *matHeaderCellDef i18n="@@crmContactList.link"> Link </th>
        
            <td mat-cell *matCellDef="let contact">
                <span>{{ contact.links[0] }}</span>
            </td>
        </ng-container>

        <!-- CUSTOM FIELDS START -->
        <ng-container [matColumnDef]="cf.name" *ngFor="let cf of crmCustomFieldsToShow">
            <th mat-header-cell *matHeaderCellDef>
                <div class="cf_cell">
                    {{ cf.title }}
                    <i class="material-icons small" *ngIf="isAdmin" (click)="removeColumn(cf)"
                        style="cursor: pointer;">close</i>
                </div>
            </th>
            <td mat-cell *matCellDef="let contact">
                <div class="cf_cell" *ngIf="!!contact.crm_custom_fields">
                    {{ contact.crm_custom_fields[column] }}
                </div>
            </td>
        </ng-container>
        <!-- CUSTOM FIELDS ENDS -->

        <ng-container matColumnDef="star">
            <th mat-header-cell *matHeaderCellDef>
                <div class="">
                    <i class="material-icons-outlined" style="cursor: pointer;" *ngIf="isAdmin"
                        [matMenuTriggerFor]="addColumn">add</i>
                </div>
                <mat-menu #addColumn="matMenu">
                    <div class="newColumnMatMenu">
                        <span i18n="@@asksTableView.addCF">Add custom field</span>
                        <mat-form-field>
                            <mat-label i18n="@@asksTableView.selectOption">Select an option</mat-label>
                            <mat-select ngDefaultControl (selectionChange)="addNewColumn($event)"
                                (click)="$event.stopPropagation()" [(ngModel)]="newColumnSelected" name="new_column">
                                <mat-option *ngFor="let f of crmCustomFields" [value]="f">{{ f.title }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </mat-menu>
            </th>
        
            <td mat-cell *matCellDef="let contact">
                <i class="material-icons-outlined ml-2 muted pointer" [matMenuTriggerFor]="menu">more_horiz</i>
                <mat-menu #menu="matMenu">
                    <a mat-menu-item (click)="openNewContactDialog(contact._id)">
                        <span i18n="@@crmContactList.edit">Edit</span>
                    </a>
                    <a mat-menu-item (click)="deleteContact(contact._id)">
                        <span i18n="@@crmContactList.delete">Delete</span>
                    </a>
                </mat-menu>
            </td>
        </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let contact; columns: displayedColumns;"></tr>
    </table>
</div>
