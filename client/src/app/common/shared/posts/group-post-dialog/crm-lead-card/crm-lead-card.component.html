<div class="">
  <div class="row">
    <label for="company" i18n="@@crmLeadCard.company" class="muted">Company</label>
  </div>

  <div class="dropdown">
    <div *ngIf="!postData?.crm?._company">
      <input type="email" class="form-control" id="search-text"
        aria-describedby="search-text" [(ngModel)]="companySearchText" placeholder="Search company" autofocus
        (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" (keyup)="searchCompany()">
        
      <ul *ngIf="!!companySearchResults && !!companySearchText" class="company-list dropdown-menu">
        <li class="company-list-item pointer" *ngFor="let company of companySearchResults" (click)="selectCompany(company)">
          <app-secured-image [imgURL]="company.company_pic" [service]="'group'" [workspaceId]="this.userData?._workspace?._id || this.userData?._workspace"
            [styleClass]="'group-avatar'"></app-secured-image>
          {{ company.name }}
        </li>
      </ul>
    </div>
  
    <div *ngIf="!!postData?.crm?._company" class="form-control" style="text-align: left;">
      <app-secured-image [imgURL]="postData?.crm?._company.company_pic" [service]="'group'"
        [workspaceId]="this.userData?._workspace?._id || this.userData?._workspace" [styleClass]="'group-avatar'"></app-secured-image>
      <span>{{ postData?.crm?._company.name }}</span>
  
      <!-- Clean field starts -->
      <i (click)="selectCompany(null)" class="material-icons muted mr-5"
        style="cursor: pointer; font-size: 14px; margin-left: 10px;">remove_circle_outline</i>
      <!-- Clean field ends -->
    </div>
  </div>

  <div class="row">
    <label for="contact" i18n="@@crmLeadCard.contacts" class="muted">Contacts</label>
  </div>

  <div class="dropdown">
    <input type="email" class="form-control " id="search-text" aria-describedby="search-text"
      [(ngModel)]="contactSearchText" placeholder="Search contact to add" autofocus (click)="$event.stopPropagation()"
      (keydown)="$event.stopPropagation()" (keyup)="searchContact()">
  
    <ul *ngIf="!!contactSearchResults && !!contactSearchText" class="company-list dropdown-menu">
      <li class="company-list-item pointer" *ngFor="let contact of contactSearchResults" (click)="selectContact(contact)">
        {{ contact.name }} - {{ contact.emails[0] }}
      </li>
    </ul>
  </div>

  <div class="row" *ngIf="!!postData?.crm?._contacts && postData?.crm?._contacts?.length > 0">
    <div class="form-control" style="text-align: left;">
      <table mat-table matSort [dataSource]="sortedData" (matSortChange)="sortData($event)" class="">
        <ng-container matColumnDef="name">
          <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@crmContactList.name"> Name </th>
      
          <td mat-cell *matCellDef="let contact">
            <span>{{ contact?.name }}</span>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="position">
          <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@crmContactList.position"> Position </th>
      
          <td mat-cell *matCellDef="let contact">
            <span>{{ contact?.position }}</span>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="phone">
          <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@crmContactList.phone"> Phone </th>
      
          <td mat-cell *matCellDef="let contact">
            <span>{{ contact?.phones[0] }}</span>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="email">
          <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@crmContactList.email"> E-Mail </th>
      
          <td mat-cell *matCellDef="let contact">
            <span>{{ contact?.emails[0] }}</span>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="link">
          <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@crmContactList.link"> Link </th>
      
          <td mat-cell *matCellDef="let contact">
            <span>{{ contact?.links[0] }}</span>
          </td>
        </ng-container>
      
        <!-- CUSTOM FIELDS START -->
        <ng-container [matColumnDef]="cf.name" *ngFor="let cf of crmCustomFieldsToShow">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            <div class="cf_cell">
              {{ cf.title }}
            </div>
          </th>
          <td mat-cell *matCellDef="let contact">
            <div class="cf_cell" *ngIf="!!contact?.crm_custom_fields">
              {{ contact?.crm_custom_fields[cf.name] }}
            </div>
          </td>
        </ng-container>
        <!-- CUSTOM FIELDS ENDS -->
      
        <ng-container matColumnDef="star">
          <th mat-header-cell *matHeaderCellDef style="text-align: right;">
          </th>
      
          <td mat-cell *matCellDef="let contact" style="text-align: right;">
            <i class="material-icons-outlined ml-2 muted pointer"
              (click)="deleteContactFromLead(contact?._id)">delete</i>
          </td>
        </ng-container>
      
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let contact; columns: displayedColumns;"></tr>
      </table>
    </div>
  </div>
</div>
