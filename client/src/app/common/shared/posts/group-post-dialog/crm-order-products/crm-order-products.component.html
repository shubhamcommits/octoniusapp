<div class="root">
  <!-- <h2>
    <span i18n="@@groupCrmSetupView.orders">Orders</span>
  </h2> -->

  <div class="block">
    <div class="row">
      <button class="btn btn-primary" (click)="openOrderDialog()">
        <i class="material-icons-outlined">add</i>
        <span i18n="@@groupCrmSetupView.newOrder">New Order</span>
      </button>
    </div>

    <table mat-table matSort [dataSource]="sortedOrderData" (matSortChange)="sortOrderData($event)" class="">
      <ng-container matColumnDef="name">
        <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@groupCrmSetupView.name"> Name </th>

        <td mat-cell *matCellDef="let order">
          <span>{{ order?._product?.name }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <th mat-header-cell mat-sort-header *matHeaderCellDef i18n="@@groupCrmSetupView.quantity"> Quantity </th>

        <td mat-cell *matCellDef="let order">
          <span>{{ order?.quantity }}</span>
        </td>
      </ng-container>

      <!-- CUSTOM FIELDS START -->
      <ng-container [matColumnDef]="cf.name" *ngFor="let cf of crmProductCustomFields">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>
          <div class="cf_cell">
            {{ cf.title }}
          </div>
        </th>

        <td mat-cell *matCellDef="let order">
          <div class="cf_cell" *ngIf="!!order?.crm_custom_fields">
            {{ order?.crm_custom_fields[cf.name] }}
          </div>
        </td>
      </ng-container>
      <!-- CUSTOM FIELDS ENDS -->

      <ng-container matColumnDef="star">
        <th mat-header-cell *matHeaderCellDef style="text-align: right;">
        </th>

        <td mat-cell *matCellDef="let order" style="text-align: right;">
          <i class="material-icons-outlined ml-2 muted pointer" [matMenuTriggerFor]="menu">more_horiz</i>
          <mat-menu #menu="matMenu">
            <a mat-menu-item (click)="openOrderDialog(order)">
              <span i18n="@@groupCrmSetupView.edit">Edit</span>
            </a>
            <a mat-menu-item (click)="deleteOrder(order?._id)">
              <span i18n="@@groupCrmSetupView.delete">Delete</span>
            </a>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedOrderColumns"></tr>
      <tr mat-row *matRowDef="let order; columns: displayedOrderColumns;"></tr>
    </table>
  </div>
</div>

<!-- Loading Spinner Starts -->
<ng-container *ngIf="isLoading$">
    <app-loading-spinner class="media"></app-loading-spinner>
</ng-container>
<!-- Loading Spinner Ends -->
