<div class="container" style="margin-bottom: 30px">
  <app-overview-page-header></app-overview-page-header>

  <!--Smart cards-->

  <div class="media">
    <div class="flex media-body">
      <!--Tasks smart card-->

      <div *ngIf="today_task_count == 0 && overdueTasks.length == 0; else tasksCard" class="smart-card col" style="margin-right: 70px">
        <a style="text-decoration:none; color:inherit;" href="/#/dashboard/overview/mytasks?mytasks=true">
          <div class="card-title mt-1">Tasks</div>
          <div class="row">
            <div class="card-first-column col-md-12">You're all done.</div>
          </div>
          <div class="row">
            <div class="card-first-column col-md-12">Get some fresh air.</div>
          </div>
          <div class="row">
          </div>

          <div class="row mt-4">
            <div class="col-md-5"></div>
            <div class="col-md-7">
              <img src='../../../assets/images/inbox-tasks-card-empty.svg' style="display:block; width: 100%">
            </div>
          </div>
        </a>
      </div>

      <ng-template #tasksCard>
        <div class="smart-card col" style="margin-right: 70px">
          <a style="text-decoration:none; color:inherit;" href="/#/dashboard/overview/mytasks?mytasks=true">
            <div class="card-title mt-1">Tasks</div>
            <div class="row">

              <div class="col-md-6">
                <div class="card-first-column">{{today_task_count}} for today</div>
              </div>

              <div class="col-md-6">
                <div class="media card-tile overview-task">
                  <div class="group-tasks to-do-task col-md-3">{{to_do_task_count}}</div>
                  <div class="group-tasks in-progress-task col-md-3">{{in_progress_task_count}}</div>
                  <div class="group-tasks done-task col-md-3">{{done_task_count}}</div>
                  <div class="group-tasks overdue-task col-md-3">{{overdueTasks.length}}</div>
                </div>
              </div>

            </div>

            <div class="overdue-total-tasks">{{overdueTasks.length}} overdue</div>
            <div class="row mt-4">
              <div class="col-md-6"></div>
              <div class="col-md-6">
                <img src='../../../assets/images/tasks-smart-card.svg' style="display:block; width: 100%">
              </div>
            </div>
          </a>
        </div>
      </ng-template>


      <!--Agenda smart card-->
      <div *ngIf="todayFirstTwoEvents.length == 0 ; else eventsCard" class="smart-card col"
           style="margin-right: 70px">
        <a style="text-decoration:none; color:inherit;" href="/#/dashboard/overview/myagenda?myagenda=true">
          <div class="row">
            <div class="col-md-8">
              <div class="card-title mt-1">Today's agenda</div>
            </div>
            <div class="col-md-4">
              <i
                class="float-right material-icons blue card-icon mt-1" id="icon_event">event
              </i>
            </div>
          </div>
          <div class="row">
            <div class="card-first-column col-md-12">Ta-da!</div>
          </div>
          <div class="row">
            <div class="card-first-column col-md-12">You're free today.</div>
          </div>
          <div class="row">
          </div>

          <div class="row mt-3">
            <div class="col-md-5"></div>
            <div class="col-md-7">
              <img src='../../../assets/images/inbox-agenda-card-empty.svg' style="display:block; width: 100%">
            </div>
          </div>
        </a>
      </div>

      <ng-template #eventsCard>
        <div class="smart-card col" style="margin-right: 70px">
          <a style="text-decoration:none; color:inherit;" href="/#/dashboard/overview/myagenda?myagenda=true">
            <div class="row">
              <div class="col-md-8">
                <div class="card-title mt-1">Today's agenda</div>
              </div>
              <div class="col-md-4">
                <i
                  class="float-right material-icons blue card-icon mt-1" id="icon_event">event
                </i>
              </div>
            </div>


            <div *ngFor="let post of todayFirstTwoEvents; let i = index;">

              <div *ngIf="post.type == 'event' && i <= 2" class="row media-body">
                <div class="col-md-3">
                  <div class="card-first-column blue">{{post.event.due_to | date:'HH:mm' }}</div>
                </div>
                <div class="col-md-8 mt-1">
                  <div class="post-title title-nowrap">{{post?.title }}</div>
                </div>
              </div>
            </div>

            <div class="post-title">
              {{today_event_count - 2 > 0 ? today_event_count - 2 : 0 }} more...
            </div>


            <div class="row">
              <div class="col-md-6"></div>
              <div class="col-md-6">
                <img src='../../../assets/images/events-smart-card.svg' style="display:block; width: 100%">
              </div>
            </div>
          </a>
        </div>
      </ng-template>


      <!--Social engagement-->
      <div class="smart-card col">
        <div class="card-title mt-1">Social Engagement</div>
        <div class="row">

          <div class="col-md-1">
            <div class="card-first-column mt-1">{{likedPostsCount}}</div>
          </div>
          <div class="col-md-2">
            <i class="material-icons blue card-icon">thumb_up</i>
          </div>
          <div class="col-md-7 post-title ml-1">most liked posts</div>
          <div class="col-md-1">
            <i class="material-icons blue float-right">keyboard_arrow_right</i>
          </div>

        </div>
        <div class="row">

          <div class="col-md-1">
            <div class="card-first-column mt-1">{{followedPostsCount}}</div>
          </div>
          <div class="col-md-2">
            <i class="material-icons overdue card-icon">star</i>
          </div>
          <div class="col-md-7 post-title ml-1">most followed post</div>
          <div class="col-md-1">
            <i class="material-icons blue float-right">keyboard_arrow_right</i>
          </div>

        </div>

        <div class="row mt-4">
          <div class="col-md-6"></div>
          <div class="col-md-6">
            <img src='../../../assets/images/social-smart-card.svg' style="display:block; width: 100%">
          </div>
        </div>
      </div>

    </div>
  </div>


  <h5 class="title-overview" *ngIf="this.recentPosts.length != 0 || comments.length != 0">Recent activity</h5>

  <!-- RECENT POSTS -->
  <div *ngIf="this.recentPosts.length != 0">


    <div *ngFor="let post of this.recentPosts; let i = index;">
      <a *ngIf="post?.type != 'document'" style="text-decoration:none; color:inherit;"
         href="/#/dashboard/group/{{post._group?._id}}/post/{{post._id}}" (click)="this.markPostAsRead(post._id)">

        <div class="media card-tile shadow-sm">
          <div class=" row media-body">
            <div class="col-md-8 flex">
              <i class="material-icons pink">chat</i>
              <img src="{{this.BASE_URL}}/uploads/{{post._posted_by?.profile_pic}}"
                   onerror="this.src='/assets/images/user.png'" class="feed-avatar">
              <p class="overview-item2" style="flex: none; line-height: 35px">{{post._posted_by?.first_name}}</p>
              <p class="overview-item2 overview-post" style="line-height: 35px"
                 [innerHTML]="post?.title | safe: 'html'"></p>
            </div>


            <div class="col-md-4 text-right">
              <span class="overview-item2 small-blue-text text-right" [innerHTML]="post?._group?.group_name"></span>
              <span class="overview-item2 small text-muted text-right">{{post.created_date | date:'MMMM d y, h:mm a' }}
              </span>
            </div>
          </div>

        </div>

      </a>

      <a *ngIf="post?.type == 'document'" style="text-decoration:none; color:inherit;"
         href="/#/dashboard/group/{{post._group?._id}}/document/{{post._id}}" (click)="this.markPostAsRead(post._id)">

        <div class="media card-tile shadow-sm">
          <div class=" row media-body">
            <div class="col-md-8 flex">
              <i class="material-icons pink">chat</i>
              <img src="{{this.BASE_URL}}/uploads/{{post._posted_by?.profile_pic}}"
                   onerror="this.src='/assets/images/user.png'" class="feed-avatar">
              <p class="overview-item2" style="flex: none; line-height: 35px">{{post._posted_by?.first_name}}</p>
              <p class="overview-item2 overview-post" style="line-height: 35px"
                 [innerHTML]="post?.title | safe: 'html'"></p>
            </div>


            <div class="col-md-4 text-right">
              <span class="overview-item2 small-blue-text text-right" [innerHTML]="post?._group?.group_name"></span>
              <span class="overview-item2 small text-muted text-right">{{post.created_date | date:'MMMM d y, h:mm a' }}
              </span>
            </div>
          </div>

        </div>

      </a>

    </div>
  </div>
  <!-- endof RECENT POSTS -->

  <div *ngIf="comments.length != 0">
    <div *ngFor="let comment of comments; let i = index;">
      <a [routerLink]="['/dashboard/group/', comment._post._group._id, 'post', comment._post._id]"
         (click)="this.markCommentAsRead(comment._id)">

        <div class="media card-tile shadow-sm">
          <div class=" row media-body">
            <div class="col-md-8 flex">
              <i class="material-icons working">chat_bubble</i>
              <img src="{{this.BASE_URL}}/uploads/{{comment._commented_by?.profile_pic}}"
                   onerror="this.src='/assets/images/user.png'" class="feed-avatar float-left">
              <p class="overview-item2" style="flex: none; line-height: 35px">{{comment._commented_by?.first_name}}
                replied</p>
              <div [innerHTML]="comment?.content | slice:0:100" class="overview-item2 overview-post"
                   style="font-size: 14px"></div>
            </div>
            <div class="col-md-4 text-right">
              <div class="overview-item2 small text-muted text-right">
                {{comment.created_date | date:'MMMM d y, h:mm a' }}
              </div>
            </div>

          </div>
        </div>


      </a>


    </div>
  </div>
</div>
